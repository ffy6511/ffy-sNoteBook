---
{"dg-publish":true,"permalink":"/obsidian///xlab///","created":"2024-08-26T12:03:57.119+08:00","updated":"2024-09-08T15:25:05.479+08:00"}
---

# æ¨èå·¥å…·
## drizzle
>https://orm.drizzle.team/docs/rqb

## formik
1.44
## SWR
>https://nextjs.org/docs/pages/building-your-application/data-fetching/client-side

åœ¨å®¢æˆ·ç«¯è·å–æ•°æ®

# æ”¹è¿›æ–¹å‘
## tailwindcss
- å®ç°æš—é»‘æ¨¡å¼
>https://tailwindcss.com/docs/dark-mode

- æ³¨å†Œæ—¶çš„å¯†ç ç¡®è®¤
- è¿›å…¥chatçš„helloæ•ˆæœ
- cookieçš„è®¾ç½®
- æ—¶é—´æ˜¾ç¤º
- æœ€åä¸€æ¡æ¶ˆæ¯
- é€€å‡ºä¸æ³¨é”€çš„åŒºåˆ«


```ts
import React from 'react';
import { Button, message, Space } from 'antd';

const App: React.FC = () => {
  const [messageApi, contextHolder] = message.useMessage();

  const success = () => {
    messageApi.open({
      type: 'success',
      content: 'This is a success message',
    });
  };

  const error = () => {
    messageApi.open({
      type: 'error',
      content: 'This is an error message',
    });
  };

  const warning = () => {
    messageApi.open({
      type: 'warning',
      content: 'This is a warning message',
    });
  };

  return (
    <>
      {contextHolder}
      <Space>
        <Button onClick={success}>Success</Button>
        <Button onClick={error}>Error</Button>
        <Button onClick={warning}>Warning</Button>
      </Space>
    </>
  );
};

export default App;
```

é“¾æ¥ï¼š
```ts
import React from 'react';
import { Button, Flex } from 'antd';

const App: React.FC = () => (
  <Flex gap="small" wrap>
    <Button type="primary">Primary Button</Button>
    <Button>Default Button</Button>
    <Button type="dashed">Dashed Button</Button>
    <Button type="text">Text Button</Button>
    <Button type="link">Link Button</Button>
  </Flex>
);

export default App;
```

```ts
import React from 'react';
import { Alert } from 'antd';

const App: React.FC = () => (
  <>
    <Alert message="Success Tips" type="success" showIcon />
    <br />
    <Alert message="Informational Notes" type="info" showIcon />
    <br />
    <Alert message="Warning" type="warning" showIcon closable />
    <br />
    <Alert message="Error" type="error" showIcon />
    <br />
    <Alert
      message="Success Tips"
      description="Detailed description and advice about successful copywriting."
      type="success"
      showIcon
    />
    <br />
    <Alert
      message="Informational Notes"
      description="Additional description and information about copywriting."
      type="info"
      showIcon
    />
    <br />
    <Alert
      message="Warning"
      description="This is a warning notice about copywriting."
      type="warning"
      showIcon
      closable
    />
    <br />
    <Alert
      message="Error"
      description="This is an error message about copywriting."
      type="error"
      showIcon
    />
  </>
);

export default App;
```
# çŸ¥è¯†è¡¥å……
â“**åˆå§‹åŒ–æ•°æ®åº“**
- `.env`ç­‰æ–‡ä»¶ä¸­ç»™å‡ºpasswordä»¥åŠdatabase
- æ ¹æ®db/schemaçš„è¡¨çš„ç»“æ„ï¼Œç¡®ä¿å­˜åœ¨å¯¹åº”çš„è¡¨
	- å¯ä»¥å…ˆè¿è¡Œ`npx drizzle-kit generate`æ¥åˆ›å»ºæ–‡ä»¶ï¼Œç„¶åå¤åˆ¶å…¶ä¸­ä»£ç 



## tRPC
> å‰ç«¯é€šè¿‡åˆ›å»º tRPC å®¢æˆ·ç«¯å¹¶å°†å…¶å¯¼å…¥åˆ°éœ€è¦çš„ç»„ä»¶ä¸­ï¼Œå¯ä»¥ç›´æ¥åœ¨ç»„ä»¶ä¸­å‘é€è¯·æ±‚åˆ°åç«¯çš„ tRPC è·¯ç”±å™¨ä¸Šã€‚è¿™ç§æ–¹å¼ç¡®ä¿äº†å‰åç«¯é€šä¿¡çš„ç±»å‹å®‰å…¨å’Œä¸€è‡´æ€§

### 1. **åˆ›å»º tRPC å®¢æˆ·ç«¯**

é¦–å…ˆï¼Œéœ€è¦åœ¨å‰ç«¯åˆ›å»ºä¸€ä¸ª tRPC å®¢æˆ·ç«¯ï¼Œè¿™ä¸ªå®¢æˆ·ç«¯ç”¨äºåœ¨å‰ç«¯è°ƒç”¨åç«¯çš„ APIã€‚

å‡è®¾åœ¨ `server` ç›®å½•ä¸­å®šä¹‰äº†ä¸€ä¸ª tRPC è·¯ç”±å™¨ï¼Œ`AppRouter` åŒ…å«äº†æ‰€æœ‰æƒ³è¦æš´éœ²ç»™å‰ç«¯çš„ APIã€‚

**åç«¯çš„ tRPC è·¯ç”±å™¨ (`server/trpcRouter.ts`)ï¼š**

```typescript
// server/trpcRouter.ts
import { router, publicProcedure } from '@trpc/server';
import { z } from 'zod';

// å®šä¹‰ä¸€ä¸ªç®€å•çš„è·¯ç”±å™¨ï¼ŒåŒ…å«ä¸€ä¸ªè·å–ç”¨æˆ·ä¿¡æ¯çš„API
export const appRouter = router({
  getUser: publicProcedure
    .input(z.object({ userId: z.string() }))
    .query(({ input }) => {
      // å‡è®¾è¿™é‡Œä»æ•°æ®åº“è·å–ç”¨æˆ·ä¿¡æ¯
      return { id: input.userId, name: "John Doe" };
    }),
});

// å¯¼å‡ºè·¯ç”±å™¨çš„ç±»å‹ä»¥ä¾›å‰ç«¯ä½¿ç”¨
export type AppRouter = typeof appRouter;
```

### 2. **åœ¨å‰ç«¯åˆ›å»º tRPC å®¢æˆ·ç«¯**

åœ¨å‰ç«¯ï¼Œä½ éœ€è¦æ ¹æ®åç«¯çš„ `AppRouter` ç±»å‹åˆ›å»ºä¸€ä¸ª tRPC å®¢æˆ·ç«¯ã€‚è¿™é€šå¸¸åœ¨ä¸€ä¸ªç‹¬ç«‹çš„æ–‡ä»¶ä¸­å®Œæˆï¼Œæ¯”å¦‚ `trpc.ts`ã€‚

**å‰ç«¯çš„ tRPC å®¢æˆ·ç«¯ (`app/trpc.ts`)ï¼š**

```typescript
// app/trpc.ts
import { createTRPCReact } from '@trpc/react';
import type { AppRouter } from '../server/trpcRouter'; // å¯¼å…¥åç«¯çš„ç±»å‹å®šä¹‰

// åŸºäºåç«¯çš„ AppRouter ç±»å‹åˆ›å»º tRPC å®¢æˆ·ç«¯
export const trpc = createTRPCReact<AppRouter>();
```

### 3. **åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ tRPC å®¢æˆ·ç«¯**

**React ç»„ä»¶ä¸­ä½¿ç”¨ tRPC (`app/components/UserProfile.tsx`)ï¼š**

```typescript
// app/components/UserProfile.tsx
import React from 'react';
import { trpc } from '../trpc'; // å¯¼å…¥ tRPC å®¢æˆ·ç«¯

const UserProfile = ({ userId }: { userId: string }) => {
  // ä½¿ç”¨ tRPC å®¢æˆ·ç«¯è°ƒç”¨ getUser API
  const { data, isLoading, error } = trpc.getUser.useQuery({ userId });

  if (isLoading) return <div>Loading...</div>;
  if (error) return <div>Error: {error.message}</div>;

  return (
    <div>
      <h1>{data?.name}</h1>
      <p>ID: {data?.id}</p>
    </div>
  );
};

export default UserProfile;
```

### 4. **è§£é‡Š**

- **å¯¼å…¥ tRPC å®¢æˆ·ç«¯**: åœ¨ `UserProfile` ç»„ä»¶ä¸­ï¼Œé¦–å…ˆå¯¼å…¥äº†åœ¨ `trpc.ts` ä¸­å®šä¹‰çš„ tRPC å®¢æˆ·ç«¯ `trpc`ã€‚

- **è°ƒç”¨ API**: ä½¿ç”¨ `trpc.getUser.useQuery` æ¥è°ƒç”¨åç«¯çš„ `getUser` APIã€‚è¿™ä¸ª API éœ€è¦ä¸€ä¸ª `userId` ä½œä¸ºè¾“å…¥å‚æ•°ï¼Œå¹¶è¿”å›ç”¨æˆ·ä¿¡æ¯ã€‚

- **è‡ªåŠ¨ç±»å‹æ£€æŸ¥**: å› ä¸º tRPC å®¢æˆ·ç«¯æ˜¯åŸºäºåç«¯çš„ `AppRouter` ç±»å‹åˆ›å»ºçš„ï¼Œ`trpc.getUser.useQuery` ä¼šè‡ªåŠ¨æ£€æŸ¥ `userId` å‚æ•°çš„ç±»å‹ï¼Œå¹¶ç¡®ä¿è¿”å›çš„æ•°æ®ä¸åç«¯çš„å®šä¹‰ä¸€è‡´ã€‚è¿™ç§ç±»å‹å®‰å…¨ç¡®ä¿äº†å‰åç«¯çš„ä¸€è‡´æ€§ï¼Œå¹¶å‡å°‘äº†å› ç±»å‹ä¸åŒ¹é…å¯¼è‡´çš„é”™è¯¯ã€‚

- **çŠ¶æ€ç®¡ç†**: `useQuery` è¿”å›çš„å¯¹è±¡åŒ…å« `data`ã€`isLoading`ã€`error` ç­‰çŠ¶æ€ä¿¡æ¯ï¼Œå¸®åŠ©ä½ è½»æ¾ç®¡ç†å¼‚æ­¥è¯·æ±‚çš„çŠ¶æ€ï¼Œå¹¶åœ¨ UI ä¸­å±•ç¤ºåˆé€‚çš„ä¿¡æ¯ã€‚

### 5. **å·¥ä½œæµç¨‹æ€»ç»“**

1. **åç«¯å®šä¹‰ API**: åœ¨åç«¯çš„ tRPC è·¯ç”±å™¨ä¸­å®šä¹‰ APIï¼Œå¹¶å¯¼å‡ºè·¯ç”±å™¨çš„ç±»å‹ã€‚

2. **å‰ç«¯åˆ›å»ºå®¢æˆ·ç«¯**: åœ¨å‰ç«¯åŸºäºåç«¯çš„è·¯ç”±å™¨ç±»å‹åˆ›å»º tRPC å®¢æˆ·ç«¯ã€‚

3. **ç»„ä»¶ä¸­è°ƒç”¨ API**: åœ¨éœ€è¦è°ƒç”¨åç«¯ API çš„ React ç»„ä»¶ä¸­ï¼Œå¯¼å…¥ tRPC å®¢æˆ·ç«¯å¹¶ä½¿ç”¨ç›¸åº”çš„ hookï¼ˆå¦‚ `useQuery` æˆ– `useMutation`ï¼‰è°ƒç”¨ APIã€‚
## next.jsçš„è·¯ç”±
### è‡ªåŠ¨è·¯ç”±
- ä»»æ„æ–‡ä»¶å¤¹çš„pageså­æ–‡ä»¶å¤¹å†…çš„æ–‡ä»¶å°†è¢«è·¯ç”±
ğŸŒ°ï¼š
	src /pages /about.js æˆ–è€… src /pages /about/ index.js å°†ä¼šè‡ªåŠ¨é€šè¿‡ **/about** è®¿é—®

- å¯ä»¥é€šè¿‡next.jsæä¾›çš„link æˆ– routerç»„ä»¶åœ¨é¡µé¢é—´è·³è½¬
ğŸŒ°ï¼š
![Pasted image 20240828222809.png](/img/user/obsidian/%E5%9B%BE%E7%89%87%E5%AF%84%E5%AD%98%E5%99%A8/Pasted%20image%2020240828222809.png)

### åŠ¨æ€è·¯ç”±
- é€šè¿‡ä½¿ç”¨æ–¹æ‹¬å· `[]`ï¼Œå¯ä»¥åœ¨ `pages` ç›®å½•ä¸­å®šä¹‰åŠ¨æ€è·¯ç”±ã€‚æ–‡ä»¶åä¸­çš„å˜é‡éƒ¨åˆ†å°†ä½œä¸ºè·¯ç”±å‚æ•°ä¼ é€’ç»™é¡µé¢ç»„ä»¶ã€‚
- ä¾‹å¦‚ï¼Œ`pages/blog/[slug].js` å¯¹åº” `/blog/:slug`ï¼Œå…¶ä¸­ `slug` æ˜¯ä¸€ä¸ªåŠ¨æ€å‚æ•°
```js
// pages/blog/[slug].js
import { useRouter } from 'next/router';

const Post = () => {
  const router = useRouter();
  const { slug } = router.query;

  return <p>Post: {slug}</p>;
};

export default Post;
```
>è®¿é—® `/blog/my-first-post`ï¼Œé¡µé¢å°†æ˜¾ç¤º `Post: my-first-post`ã€‚

### APIè·¯ç”±
ä»»ä½•åœ¨ `pages/api` ä¸­çš„æ–‡ä»¶éƒ½ä¼šæˆä¸ºä¸€ä¸ª API è·¯ç”±ï¼Œå¹¶åœ¨æœåŠ¡å™¨ç«¯æ‰§è¡Œ
ğŸŒ°ï¼š`pages/api/hello.js` å¯¹åº” `/api/hello`ï¼Œç”¨äºå¤„ç† HTTP è¯·æ±‚å¹¶è¿”å› JSON å“åº”
```js
// pages/api/hello.js
export default function handler(req, res) {
  res.status(200).json({ message: 'Hello, World!' });
}
```

### ğŸ“:
å‡è®¾æ–‡ä»¶å¤¹ç»“æ„å¦‚ä¸‹ï¼š
```
my-next-app/
â”œâ”€â”€ pages/
â”‚   â”œâ”€â”€ index.js
â”‚   â”œâ”€â”€ about.js
â”‚   â”œâ”€â”€ blog/
â”‚   â”‚   â”œâ”€â”€ index.js
â”‚   â”‚   â””â”€â”€ [slug].js
â”‚   â””â”€â”€ api/
â”‚       â””â”€â”€ hello.js
```
- `/` ä¼šåŠ è½½ `index.js` ä¸­çš„å†…å®¹ã€‚
- `/about` ä¼šåŠ è½½ `about.js` ä¸­çš„å†…å®¹ã€‚
- `/blog` ä¼šåŠ è½½ `blog/index.js` ä¸­çš„å†…å®¹ã€‚
- `/blog/some-post` ä¼šåŠ è½½ `blog/[slug].js`ï¼Œå¹¶å°† `slug` è®¾ç½®ä¸º `some-post`ã€‚
- `/api/hello` æ˜¯ä¸€ä¸ª API è·¯ç”±ï¼Œè¿”å› JSON å“åº”ã€‚

## nextä¸‹çš„é¡µé¢è·³è½¬
### link

ğŸŒ°:
```tsx
// app/page.js  
import Link from 'next/link';  
import Login from './user/Login/Login';  
  
function JumpToChat() {  
    return (  
        <div>  
            <Link href="/chatroom">  
                Go to Chat
            </Link>  
            <Login />  
        </div>  
    );  
}  
  
export default JumpToChat;  
```
>ä½œä¸ºpage

```tsx
// app/page.js    
import Login from './user/Login/Login';  
  
export default function Page() {  
    return <Login />;
}


```

### useRouter
>æ˜¯ä¸€ä¸ª React Hook,å¯ä»¥æ–¹ä¾¿åœ°è·å–è·¯ç”±ä¿¡æ¯ã€æ‰§è¡Œè·¯ç”±è·³è½¬ç­‰æ“ä½œ

#### ğŸŒ°ï¼š
```js
import { useRouter } from 'next/router';

function MyComponent() {
  const router = useRouter();

  const handleClick = () => {
    // è·³è½¬åˆ° /about é¡µé¢
    router.push('/about');
  };

  return (
    <div>
      <p>Current Route: {router.pathname}</p>
      <button onClick={handleClick}>Go to About</button>
    </div>
  );
}

export default MyComponent;
```

#### ç‰¹ç‚¹
- **ä»…é™äºå‡½æ•°ç»„ä»¶**: `useRouter` åªèƒ½åœ¨å‡½æ•°ç»„ä»¶ä¸­ä½¿ç”¨ï¼Œè¿™æ˜¯å› ä¸ºå®ƒæ˜¯ä¸€ä¸ª React Hookã€‚
- **è®¿é—®è·¯ç”±ä¿¡æ¯**: é€šè¿‡ `router` å¯¹è±¡ï¼Œå¯ä»¥è·å–å½“å‰è·¯å¾„ (`pathname`)ã€æŸ¥è¯¢å‚æ•° (`query`)ã€è·¯ç”±è·¯å¾„ (`asPath`) ç­‰ã€‚
- **è·¯ç”±è·³è½¬**: `useRouter` æä¾›äº† `push`ã€`replace` ç­‰æ–¹æ³•ï¼Œç”¨äºæ‰§è¡Œè·¯ç”±è·³è½¬ã€‚

### withRouter
>ä¸€ä¸ªé«˜é˜¶ç»„ä»¶,å¯ä»¥å°†è·¯ç”±å¯¹è±¡ä½œä¸º `props` ä¼ é€’ç»™ä»»æ„ç»„ä»¶ã€‚

#### ğŸŒ°ï¼š
```js
import { withRouter } from 'next/router';

class MyComponent extends React.Component {
  handleClick = () => {
    const { router } = this.props;
    // è·³è½¬åˆ° /about é¡µé¢
    router.push('/about');
  };

  render() {
    const { router } = this.props;
    return (
      <div>
        <p>Current Route: {router.pathname}</p>
        <button onClick={this.handleClick}>Go to About</button>
      </div>
    );
  }
}

export default withRouter(MyComponent);
```
>ä¸å»ºè®®ç”¨åœ¨å‡½æ•°ç»„ä»¶


## è·¯ç”±çš„å®ä¾‹è¯´æ˜

åç«¯ï¼šè®¾ç½®å‡½æ•°å¹¶è·¯ç”±åˆ°ä¸€ä¸ªAppRouteræ•´ä½“ï¼ˆå¹¶å¯¼å‡ºç±»å‹ï¼Œä¸ºå‰ç«¯çš„è°ƒç”¨æœåŠ¡ï¼‰
>![Pasted image 20240828224436.png](/img/user/obsidian/%E5%9B%BE%E7%89%87%E5%AF%84%E5%AD%98%E5%99%A8/Pasted%20image%2020240828224436.png)

å‰åç«¯ä¹‹é—´ï¼š
>![Pasted image 20240828224455.png](/img/user/obsidian/%E5%9B%BE%E7%89%87%E5%AF%84%E5%AD%98%E5%99%A8/Pasted%20image%2020240828224455.png)

å‰ç«¯çš„è°ƒç”¨ï¼š
>![Pasted image 20240828224336.png](/img/user/obsidian/%E5%9B%BE%E7%89%87%E5%AF%84%E5%AD%98%E5%99%A8/Pasted%20image%2020240828224336.png)
>ç»“åˆ`next.jsçš„è·¯ç”±/APIè·¯ç”±`å†…å®¹å¯çŸ¥ï¼Œå°† `tRPC` è·¯ç”±å™¨æš´éœ²ä¸º API ç«¯ç‚¹.
>ä½¿ `tRPC` è·¯ç”±å™¨åœ¨ `http://localhost:3000/api/trpc` è¿™ä¸ªè·¯å¾„ä¸‹å¯ç”¨ã€‚æ¯ä¸€ä¸ªå®šä¹‰åœ¨ `appRouter` ä¸­çš„è·¯ç”±éƒ½ä¼šå¯¹åº”ä¸€ä¸ª URL è·¯å¾„ï¼ˆä¾‹å¦‚ `auth.login` å¯¹åº” `/api/trpc/auth.login`ï¼‰ã€‚
>![Pasted image 20240828224606.png](/img/user/obsidian/%E5%9B%BE%E7%89%87%E5%AF%84%E5%AD%98%E5%99%A8/Pasted%20image%2020240828224606.png)ä¸ºä¾‹ï¼ˆæ­¤å¤„è¡Œ8,13ï¼‰
>


## tRPCä¸Šä¸‹æ–‡
- å«ä¹‰ï¼š
	â€œä¸Šä¸‹æ–‡â€æŒ‡çš„æ˜¯ä¸€ç§åœ¨ç»„ä»¶æ ‘ä¸­ä¼ é€’æ•°æ®çš„æ–¹å¼ï¼Œä½¿å¾—ç»„ä»¶å¯ä»¥å…±äº«ä¸€äº›å…¨å±€æ•°æ®ï¼Œè€Œä¸éœ€è¦é€šè¿‡ä¸€å±‚ä¸€å±‚çš„propsä¼ é€’ã€‚tRPCä¸Šä¸‹æ–‡æ˜¯ä¸€ä¸ªä¸“é—¨ç”¨äºç®¡ç†å’Œæä¾›tRPCç›¸å…³åŠŸèƒ½å’Œæ•°æ®çš„ä¸Šä¸‹æ–‡

>https://trpc.io/docs/server/context#defining-the-context-type


