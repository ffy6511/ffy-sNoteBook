---
{"dg-publish":true,"permalink":"/obsidian///xlab///","created":"2024-07-02T14:45:33.332+08:00","updated":"2024-09-08T15:25:05.453+08:00"}
---

# åŸºç¡€æ¦‚å¿µ
---
DOM
	æ–‡æ¡£å¯¹è±¡æ¨¡å‹,æ˜¯HTMLå’ŒXMLæ–‡æ¡£çš„ç¼–ç¨‹æ¥å£ã€‚å®ƒå°†ç½‘é¡µè¡¨ç¤ºä¸ºä¸€ä¸ªæ ‘å½¢ç»“æ„ã€‚

Fetch API
	ç°ä»£æµè§ˆå™¨æä¾›çš„ç”¨äºç½‘ç»œè¯·æ±‚çš„æ¥å£

JSON
	Â ä¸€ç§è½»é‡çº§çš„æ•°æ®äº¤æ¢æ ¼å¼,æ˜“äºäººé˜…è¯»å’Œç¼–å†™,ä¹Ÿæ˜“äºæœºå™¨è§£æå’Œç”Ÿæˆã€‚

# æµç¨‹åˆ†æ
>é‡ç‚¹å…³æ³¨JSä¸åç«¯çš„äº¤äº’

## CSSç½‘é¡µ
>https://neumorphism.io/#e6eef4

>Â  Â  justify-content:space-between; å¯ä»¥ä½¿å¾—å…ƒç´ æ²¿ä¸»è½´åˆ†å¸ƒï¼Œä¸”åˆ†åˆ«ä¸ºå·¦å¯¹é½å’Œå³å¯¹é½
---
## è·¯ç”±å™¨
>å°†å‰ç«¯jså½“ä¸­çš„urlä¸åç«¯è´Ÿè´£å“åº”çš„handler.goå‡½æ•°ç›¸äº’è”ç³»;
>	æ ¹æ®è¯·æ±‚çš„ URL è°ƒç”¨ç›¸åº”çš„å¤„ç†ç¨‹åº

ğŸŒ°æŸ¥è¯¢è¯„è®ºï¼š

â‘ åç«¯ä¸­çš„router
```go
Â  Â  router.HandleFunc("/comment/get", GetComments).Methods("GET")
```
è¡¨ç¤ºå°†ç›¸å¯¹è·¯å¾„ä¸º`/comment/get`çš„`URL`è¯·æ±‚ç”¨GetCommentså‡½æ•°è¿›è¡Œå“åº”ï¼Œå¹¶ä¸”æŒ‡å®šè¯·æ±‚æ–¹å¼ä¸ºGET

â‘¡å‰ç«¯çš„fetchComments
```js
  //è·å–è¯„è®º
    async function fetchComments(page) {
        const response = await fetch(`http://localhost:8080/comment/get?page=${page}&size=${pageSize}`);

        const data = await response.json();
        return data.data;
    }
```
å¯ä»¥çœ‹åˆ°å¯¹åº”çš„URL

â‘¢GETComments
```go
func GetComments(w http.ResponseWriter, r *http.Request) {
	// ä»è¯·æ±‚ä¸­è·å–åˆ†é¡µå‚æ•°
	page, _ := strconv.Atoi(r.URL.Query().Get("page"))
	size, _ := strconv.Atoi(r.URL.Query().Get("size"))

	// è®¾ç½®é»˜è®¤å€¼
	if page < 1 {
		page = 1
	}
	if size < 1 {
		size = 10
	}

	var comments []Comment
	DB.Offset((page - 1) * size).Limit(size).Find(&comments) // åˆ†é¡µæŸ¥è¯¢è¯„è®º

	var total int64
	DB.Model(&Comment{}).Count(&total) // è·å–è¯„è®ºæ€»æ•°

	response := Response{
		Code: 0,
		Msg:  "success",
		Data: map[string]interface{}{
			"total":    total,
			"comments": comments,
		},
	}
	w.Header().Set("Content-Type", "application/json")
	json.NewEncoder(w).Encode(response)
}
```

â“ç›¸å¯¹ä½•å¤„çš„è·¯å¾„ï¼Ÿ
	`main.go`ä¸­ç¡®å®šäº†ä¸»è·¯å¾„
```go
func main() {
    Init()
    router := NewRouter()
    router.HandleFunc("/favicon.ico", func(w http.ResponseWriter, r *http.Request) {
        w.WriteHeader(http.StatusNoContent)
    })
    // è®¾ç½®ä¸­é—´ä»¶
    corsRouter := handlers.CORS(
        handlers.AllowedOrigins([]string{"http://localhost:8081"}),            // å…è®¸æ¥è‡ªhttp://localhost:8081çš„è¯·æ±‚
        handlers.AllowedMethods([]string{"GET", "POST", "DELETE", "OPTIONS"}), // å…è®¸çš„HTTPæ–¹æ³•
        handlers.AllowedHeaders([]string{"Content-Type"}),                     // å…è®¸çš„Header
    )(router)

    log.Println("Server started at :8080")
    log.Fatal(http.ListenAndServe(":8080", corsRouter))
}
```
æ­¤å¤„æœ€åä¸€è¡ŒæŒ‡å®šæœåŠ¡å™¨ç›‘å¬çš„ç«¯å£æ˜¯8080ï¼Œä¹Ÿå°±æ˜¯`http://localhost:8080`

---
## åˆå§‹åŒ–å’Œäº‹ä»¶ç›‘å¬
```js
// ç­‰å¾…DOMå®Œå…¨åŠ è½½åæ‰§è¡Œä»£ç 
document.addEventListener('DOMContentLoaded', () => {
    // è·å–é¡µé¢ä¸Šçš„å„ä¸ªå…ƒç´ 
    const commentForm = document.getElementById('comment-form');
    const commentList = document.getElementById('comment-list');
    const prevButton = document.getElementById('prev-page');
    const nextButton = document.getElementById('next-page');
    const pageInfo = document.getElementById('page-info');

    // åˆå§‹åŒ–åˆ†é¡µç›¸å…³å˜é‡
    let currentPage = 1;
    let totalPages = 1;
    const pageSize = 10; // æ¯é¡µæ˜¾ç¤ºçš„è¯„è®ºæ•°

    // ... å…¶ä»–ä»£ç  ...

    // åˆå§‹åŠ è½½è¯„è®º
    loadComments();
});

```
- ç­‰å¾…DOMåŠ è½½å®Œæˆåæ‰§è¡Œ
- è·å–é¡µé¢ä¸Šçš„å„ä¸ªé‡è¦å…ƒç´ 
- è°ƒç”¨`loadComments()`å‡½æ•°åŠ è½½åˆå§‹è¯„è®º

## æäº¤æ–°è¯„è®º
```js
commentForm.addEventListener('submit', async (e) => {
    e.preventDefault(); // é˜»æ­¢è¡¨å•é»˜è®¤æäº¤è¡Œä¸º

    // è·å–ç”¨æˆ·åå’Œè¯„è®ºå†…å®¹
    const usernameInput = document.getElementById('username');
    const commentContentInput = document.getElementById('comment-content');
    // å»é™¤é¦–å°¾ç©ºæ ¼
    const username = usernameInput.value.trim();
    const content = commentContentInput.value.trim();

    if (username && content) { // å¦‚æœç”¨æˆ·åå’Œå†…å®¹éƒ½ä¸ä¸ºç©º
        // è°ƒç”¨addCommentå‡½æ•°æ·»åŠ æ–°è¯„è®º
        const newComment = await addComment({ name: username, content: content });
        if (newComment) {
            // å¦‚æœæˆåŠŸæ·»åŠ è¯„è®º
            addCommentToDOM(newComment); // å°†æ–°è¯„è®ºæ·»åŠ åˆ°DOM
            commentContentInput.value = ''; // æ¸…ç©ºè¯„è®ºå†…å®¹è¾“å…¥æ¡†
            commentContentInput.focus(); // å°†ç„¦ç‚¹æ”¾å›è¯„è®ºè¾“å…¥æ¡†
            currentPage = 1; // é‡ç½®åˆ°ç¬¬ä¸€é¡µ
            loadComments(); // é‡æ–°åŠ è½½è¯„è®ºåˆ—è¡¨
        } else {
            commentContentInput.focus(); // å¦‚æœæ·»åŠ å¤±è´¥,ä¿æŒç„¦ç‚¹åœ¨è¯„è®ºè¾“å…¥æ¡†
        }
    }
});
```
- ç›‘å¬è¯„è®ºè¡¨å•çš„æäº¤äº‹ä»¶
- æäº¤æ–°è¯„è®ºæ—¶,å®ƒä¼šé˜»æ­¢è¡¨å•çš„é»˜è®¤æäº¤è¡Œä¸º,è·å–ç”¨æˆ·è¾“å…¥çš„ç”¨æˆ·åå’Œè¯„è®ºå†…å®¹,
- è°ƒç”¨`addComment`å‡½æ•°å°†æ–°è¯„è®ºå‘é€åˆ°æœåŠ¡å™¨ã€‚

## æ·»åŠ è¯„è®ºåˆ°æœåŠ¡å™¨
```js
// æ·»åŠ è¯„è®ºè¯·æ±‚
async function addComment(comment) {
    // ä½¿ç”¨Fetch APIå‘é€POSTè¯·æ±‚åˆ°æœåŠ¡å™¨
    const response = await fetch('http://localhost:8080/comment/add', {
        method: 'POST', // ä½¿ç”¨POSTæ–¹æ³•
        headers: {
            'Content-Type': 'application/json', // è®¾ç½®å†…å®¹ç±»å‹ä¸ºJSON
        },
        body: JSON.stringify(comment), // å°†è¯„è®ºå¯¹è±¡è½¬æ¢ä¸ºJSONå­—ç¬¦ä¸²
    });
    const data = await response.json(); // è§£ææœåŠ¡å™¨è¿”å›çš„JSONå“åº”
    return data.data; // è¿”å›æœåŠ¡å™¨è¿”å›çš„æ•°æ®
}
```
- ä½¿ç”¨Fetch APIå‘æœåŠ¡å™¨å‘é€POSTè¯·æ±‚
- å°†è¯„è®ºå¯¹è±¡è½¬æ¢ä¸ºJSONå­—ç¬¦ä¸²ï¼Œå¹¶åœ¨è¯·æ±‚å¤´ä¸­è®¾ç½®å†…å®¹ç±»å‹ä¸ºJSON
- æœåŠ¡å™¨å¤„ç†è¯·æ±‚å,å‡½æ•°è§£æè¿”å›çš„JSONå“åº”å¹¶è¿”å›æ•°æ®

â“ä¸¤ä¸ªdataçš„åŒºåˆ«
1. ç¬¬ä¸€ä¸ªdataè¡¨ç¤ºå˜é‡åï¼Œç”¨fetchè¯·æ±‚çš„è¿”å›å€¼ä½œä¸ºå€¼
2. ç¬¬äºŒä¸ªdataæ˜¯è¿”å›å€¼æ‰€åŒ…å«çš„å¯¹è±¡ï¼š
```go
type Response struct {
    Code int         `json:"code"`
    Msg  string      `json:"msg"`
    Data interface{} `json:"data"`
}
```
åœ¨åç«¯çš„ç»“æ„ä½“å®šä¹‰å½“ä¸­ï¼Œè¿”å›çš„Dataçš„jsonå½¢å¼ä¸­è¢«ç§°ä¸ºdata

## åŠ è½½è¯„è®º
```js
async function loadComments() {
    // ä»æœåŠ¡å™¨è·å–è¯„è®º
    const { comments, total } = await fetchComments(currentPage);
    commentList.innerHTML = ''; // æ¸…ç©ºå½“å‰è¯„è®ºåˆ—è¡¨
    comments.forEach(comment => addCommentToDOM(comment)); // å°†æ¯æ¡è¯„è®ºæ·»åŠ åˆ°DOM

    // æ›´æ–°åˆ†é¡µä¿¡æ¯
    totalPages = Math.max(1, Math.ceil(total / pageSize));
    pageInfo.textContent = `Page ${currentPage} of ${totalPages}`;

    // æ›´æ–°åˆ†é¡µæŒ‰é’®çŠ¶æ€
    prevButton.disabled = currentPage === 1;
    nextButton.disabled = currentPage >= totalPages;
}

async function fetchComments(page) {
    // ä½¿ç”¨Fetch APIä»æœåŠ¡å™¨è·å–è¯„è®º
    const response = await fetch(`http://localhost:8080/comment/get?page=${page}&size=${pageSize}`);
    const data = await response.json();
    return data.data;
}
```
- è°ƒç”¨`fetchComments`å‡½æ•°è·å–ç‰¹å®šé¡µçš„è¯„è®º
- `commentList.innerHTML = ''`  å°†æ¸…ç©ºå½“å‰è¯„è®ºåˆ—è¡¨
- å°†æ–°çš„è¯„è®ºæ·»åŠ åˆ°DOMä¸­

## åˆ é™¤è¯„è®º
```js
async function deleteComment(id) {
    // ä½¿ç”¨Fetch APIå‘é€POSTè¯·æ±‚åˆ é™¤è¯„è®º
    await fetch(`http://localhost:8080/comment/delete?id=${id}`, {
        method: 'POST',
    });
}

function addCommentToDOM(comment) {
    // ... åˆ›å»ºè¯„è®ºå…ƒç´ çš„ä»£ç  ...

    const deleteButton = document.createElement('button');
    deleteButton.textContent = 'Delete';
    deleteButton.addEventListener('click', async () => {
        await deleteComment(comment.id); // è°ƒç”¨deleteCommentå‡½æ•°åˆ é™¤è¯„è®º
        commentList.removeChild(commentItem); // ä»DOMä¸­ç§»é™¤è¯„è®ºå…ƒç´ 
    });

    // ... å°†åˆ é™¤æŒ‰é’®æ·»åŠ åˆ°è¯„è®ºå…ƒç´ çš„ä»£ç  ...
}
```
- å‘æœåŠ¡å™¨å‘é€POSTè¯·æ±‚æ¥åˆ é™¤ç‰¹å®šIDçš„è¯„è®º
- 


# äº¤äº’åˆ†æ
---
## æŸ¥è¯¢è¯„è®º

1. `fetchComments`ç”¨äºå‘åç«¯å‘é€æŸ¥è¯¢å¯¹åº”é¡µæ•°è¯„è®ºçš„è¯·æ±‚ï¼Œå¦‚æœæˆåŠŸåˆ™è¿”å›å¯¹åº”çš„æ•°æ®
2. `loadComments`å°†å½“å‰é¡µæ•°`currentPage`ä½œä¸º`fetchComments`çš„å‚æ•°,å°†è¿”å›çš„æ•°æ®éå†è°ƒç”¨`addCommentToDOM`æ¥å¯è§†åŒ–
3. æ‰€ä»¥ä¸»ä½“æ˜¯`load`ï¼Œå®ƒå°†è°ƒç”¨`fetch`ä¸`add`å‡½æ•°ï¼Œåˆ†åˆ«å‘åç«¯å‘é€è¯·æ±‚ ä»¥åŠ å¯è§†åŒ–
```js
async function fetchComments(page) {
    const response = await fetch(`http://localhost:8080/comment/get?page=${page}&size=${pageSize}`);
    const data = await response.json();
    return data.data;
}
```

```js
 async function loadComments() {
        const { comments, total } = await fetchComments(currentPage);
        commentList.innerHTML = ''; // æ¸…ç©ºè¯„è®ºåˆ—è¡¨
        comments.forEach(comment => addCommentToDOM(comment)); // æ·»åŠ æ–°è¯„è®º

        totalPages = Math.max(1, Math.ceil(total / pageSize));
        pageInfo.textContent = `Page ${currentPage} of ${totalPages}`;

        prevButton.disabled = currentPage === 1;
        nextButton.disabled = currentPage >= totalPages;
    }
```

```js
  // å°†è¯„è®ºæ·»åŠ åˆ°DOMä¸­
    function addCommentToDOM(comment) {
	    //åˆ›å»ºä¸€ä¸ªåˆ—è¡¨ç±»çš„å…ƒç´ 
        const commentItem = document.createElement('li');
        //å°†æ•°æ®çš„idèµ‹å€¼ç»™è¯¥å…ƒç´ çš„HTMLå±æ€§id
        commentItem.dataset.id = comment.id;

        const commentText = document.createElement('span');
        
        //ç”¨`å¹¶å°†æ•°æ®çš„ç±»å‹èµ‹å€¼ç»™æ–‡æœ¬å†…å®¹
        commentText.textContent = `${comment.name}: ${comment.content}`;

		//å¯¹äºæ¯æ¡è¯„è®ºï¼Œæ ¹æ®idè®¾ç½®å¯¹é¥®çš„åˆ é™¤æŒ‰é’®
        const deleteButton = document.createElement('button');
        deleteButton.textContent = 'Delete';
        deleteButton.addEventListener('click', async () => {
            await deleteComment(comment.id);
            commentList.removeChild(commentItem);
        });

        commentItem.appendChild(commentText);
        commentItem.appendChild(deleteButton);

        commentList.insertBefore(commentItem, commentList.firstChild); // æ·»åŠ æ–°è¯„è®ºåˆ°åˆ—è¡¨çš„å¼€å¤´
    }
```

```go
func GetComments(w http.ResponseWriter, r *http.Request) {
    // ä»è¯·æ±‚ä¸­è·å–åˆ†é¡µå‚æ•°
    page, _ := strconv.Atoi(r.URL.Query().Get("page"))
    size, _ := strconv.Atoi(r.URL.Query().Get("size"))

    // è®¾ç½®é»˜è®¤å€¼
    if page < 1 {
        page = 1
    }
    if size < 1 {
        size = 10
    }

    var comments []Comment
    DB.Offset((page - 1) * size).Limit(size).Find(&comments) // åˆ†é¡µæŸ¥è¯¢è¯„è®º
    //Offset è®¾ç½®äº†æŸ¥è¯¢çš„åç§»é‡ï¼Œè¡¨ç¤ºåç§»(page-1ï¼‰*sizeä¸ªæ•°æ®ï¼Œä¿è¯æ­£ç¡®æ˜¾ç¤ºcurrentPageé¡µçš„è¯„è®º
    //Limit(size)ç¡®ä¿æœ€å¤šæ˜¾ç¤ºsizeå¾—è¯„è®ºä¸ªæ•°ï¼Œé˜²æ­¢åé¢çš„è¯„è®ºåŒæ—¶æ˜¾ç¤º
    //Findjå°†æŸ¥è¯¢çš„æ•°æ®ç»“æœèµ‹å€¼ç»™äº†ä¸Šé¢çš„ç»“æ„ä½“commentç±»å‹çš„æ•°ç»„

    var total int64
    DB.Model(&Comment{}).Count(&total) // è·å–è¯„è®ºæ€»æ•°ï¼Œå­˜å‚¨åˆ°totalå½“ä¸­

    response := Response{
        Code: 0,
        Msg:  "success",
        Data: map[string]interface{}{
            "total":    total,
            "comments": comments,
        },
    }
    w.Header().Set("Content-Type", "application/json")
    json.NewEncoder(w).Encode(response)
}

```
## æ·»åŠ è¯„è®º

## åˆ é™¤è¯„è®º
```js
async function deleteComment(id) {
    await fetch(`http://localhost:8080/comment/delete?id=${id}`, {
        method: 'POST',
    });
}
```
>å‰ç«¯é€šè¿‡Â `fetch`Â å‡½æ•°å‘é€ POST è¯·æ±‚åˆ°Â `/comment/delete`Â ç«¯ç‚¹ï¼ŒURL ä¸­åŒ…å«è¦åˆ é™¤çš„è¯„è®º ID

```go
func DeleteComment(w http.ResponseWriter, r *http.Request) {
    idStr := r.URL.Query().Get("id")  //ä» URL æŸ¥è¯¢å‚æ•°ä¸­æå–è¯„è®º IDã€‚
    id, err := strconv.Atoi(idStr)    //åœ¨æ•°æ®åº“ä¸­æŸ¥æ‰¾å¯¹åº” ID çš„è¯„è®º,æ‰¾ä¸åˆ°æ—¶errè¿”å›çœŸå€¼
    if err != nil {
        http.Error(w, "Invalid ID", http.StatusBadRequest)
        return
    }

    var comment Comment // Commentç±»å‹çš„å˜é‡comment

	//ä½¿ç”¨äº†æ•°æ®åº“æ“ä½œï¼Œå°è¯•ä»æ•°æ®åº“ä¸­è·å–ç‰¹å®š ID çš„è¯„è®ºæ•°æ®
    if DB.First(&comment, id).Error != nil { 
        http.Error(w, "Comment not found", http.StatusNotFound)
        return
    }
	//æˆåŠŸåˆ é™¤åˆ™æ„é€ ä¸€ä¸ªè¡¨ç¤ºæ“ä½œæˆåŠŸçš„ JSON å“åº”ï¼Œå¹¶è¿”å›å‰ç«¯
    DB.Delete(&comment)

    response := Response{
        Code: 0,
        Msg:  "success",
        Data: nil,
    }
    w.Header().Set("Content-Type", "application/json")
    json.NewEncoder(w).Encode(response)
}
```

## åˆ†é¡µè½¬æ¢
